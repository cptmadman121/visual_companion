<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:DeskLLM.Avalonia.ViewModels"
        xmlns:views="clr-namespace:DeskLLM.Avalonia.Views"
        x:Class="DeskLLM.Avalonia.Views.MainWindow"
        Width="980" Height="680"
        TransparencyLevelHint="AcrylicBlur, Blur"
        Background="{StaticResource BrushSurface}"
        Title="DeskLLM">
  <Design.DataContext>
    <vm:MainViewModel />
  </Design.DataContext>

  <ScrollViewer Margin="16"
                HorizontalScrollBarVisibility="Disabled"
                VerticalScrollBarVisibility="Auto">
    <Border Classes="card">
      <Grid RowDefinitions="Auto,*,Auto" ColumnDefinitions="*">
      <!-- Title Bar -->
      <Grid ColumnDefinitions="Auto,*,Auto" Height="48">
        <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
          <Path Data="M12,2 L2,7 L12,12 L22,7 Z" Fill="{StaticResource BrushBrandPrimary}" Width="16" Height="16" Margin="8,0"/>
          <TextBlock Classes="h2" Text="DeskLLM"/>
        </StackPanel>
        <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" Spacing="8">
          <Button x:Name="SettingsButton" Content="Settings" Click="OnOpenSettings"/>
          <Button x:Name="NewSessionButton" Classes="primary" Content="New Session" Click="OnNewSession"/>
        </StackPanel>
      </Grid>

      <!-- Content -->
      <Grid Grid.Row="1" ColumnDefinitions="Auto,*" RowDefinitions="Auto,*" Margin="0,8,0,8">
        <!-- Left Column: Prompt + Options -->
        <StackPanel Spacing="12" Margin="8,0,8,0" Width="320">
          <TextBlock Classes="h1" Text="Ask anything"/>
          <Border x:Name="PromptCard" Classes="card">
            <StackPanel Spacing="8">
              <TextBlock Classes="caption" Text="Prompt"/>
              <TextBox x:Name="PromptBox" AcceptsReturn="True" TextWrapping="Wrap" Height="140" Watermark="Type your prompt..." Text="{Binding Prompt, Mode=TwoWay}"/>

              <TextBlock Classes="caption" Text="Model (Ollama)"/>
              <ComboBox x:Name="ModelPicker"
                        MinWidth="220"
                        HorizontalAlignment="Stretch"
                        SelectionChanged="OnModelPickerSelectionChanged"
                        DropDownOpened="OnModelPickerDropDownOpened"/>

              <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
                <Button x:Name="CaptureButton" Content="Capture" Click="OnCapture"/>
                <Button x:Name="SendButton" Classes="primary" Content="Send" Click="OnSend"/>
              </StackPanel>
            </StackPanel>
          </Border>
        </StackPanel>

        <!-- Right Column: Conversation -->
        <Border x:Name="ConversationCard" Grid.Column="1" Classes="card" Margin="0,0,8,0" ClipToBounds="True">
          <Grid RowDefinitions="Auto,*">
            <TextBlock Classes="h1" Margin="0,0,0,8" Text="Conversation"/>
            <ScrollViewer x:Name="TranscriptViewer"
                          Grid.Row="1"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled"
                          ClipToBounds="True">
              <ItemsControl x:Name="MessagesView"
                            ItemsSource="{Binding Messages}">
                <ItemsControl.ItemsPanel>
                  <ItemsPanelTemplate>
                    <StackPanel Orientation="Vertical"/>
                  </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <Border Margin="0,8" Background="#16161D" CornerRadius="10" Padding="12" HorizontalAlignment="Stretch">
                      <TextBlock TextWrapping="Wrap" Text="{Binding}" HorizontalAlignment="Stretch"/>
                    </Border>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </ScrollViewer>
          </Grid>
        </Border>
      </Grid>

      <!-- Footer -->
      <Grid Grid.Row="2">
        <TextBlock Classes="caption" HorizontalAlignment="Right" Text="Press Ctrl+Shift+Space to open"/>
      </Grid>
      </Grid>
    </Border>
  </ScrollViewer>

  <!-- Simple, robust layout; column content stacks gracefully on narrow widths -->
</Window>
